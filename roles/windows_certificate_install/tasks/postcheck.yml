---
- name: Post-check | Build consolidated certificate install summary on control node
  run_once: true
  delegate_to: localhost
  vars:
    _install_results: >-
      {{
        ansible_play_hosts_all
        | map('extract', hostvars, 'certificate_install_result')
        | select('defined')
        | list
      }}
  ansible.builtin.copy:
    dest: "{{ install_summary_file }}"
    mode: "0644"
    content: "{{ _install_results | to_nice_json }}"
  register: install_summary_result

- name: Post-check | Verify install summary file exists
  run_once: true
  delegate_to: localhost
  ansible.builtin.stat:
    path: "{{ install_summary_result.dest }}"
  register: install_summary_stat

- name: Post-check | Print certificate install summary location
  run_once: true
  delegate_to: localhost
  ansible.builtin.debug:
    msg:
      - "Certificate install summary file: {{ install_summary_result.dest }}"
      - "Summary exists: {{ install_summary_stat.stat.exists }}"
